##### БЫСТРАЯ СПРАВКА ПО TMUX #####
# 
# ОСНОВНЫЕ КОМАНДЫ:
#   prefix + ?          - показать список всех команд (шпаргалка)
#   prefix + d          - отключиться от сессии (сессия продолжит работать)
#   prefix + :          - командная строка tmux
#   prefix + [          - режим копирования (прокрутка истории)
#   prefix + ]          - вставить из буфера tmux
#
# УСТАНОВКА ПЛАГИНОВ:
#   1. Раскомментируйте нужный плагин в секции "Плагины"
#   2. Нажмите prefix + I (Shift+i) - установить плагины
#   3. Нажмите prefix + U (Shift+u) - обновить плагины
#   4. Нажмите prefix + alt + u - удалить неиспользуемые плагины
#
# ПОЛЕЗНЫЕ КОМАНДЫ ИЗ ТЕРМИНАЛА:
#   tmux ls                    - список всех сессий
#   tmux new -s имя            - создать новую сессию с именем
#   tmux attach -t имя         - подключиться к сессии
#   tmux kill-session -t имя   - убить сессию
#   tmux kill-server           - убить все сессии
#
# РАСКОММЕНТИРОВАНИЕ КОМАНД:
#   Удалите символ # в начале строки для активации команды
#   После изменений выполните: prefix + : source-file ~/.config/tmux/tmux.conf

# Удобное переключение между окнами и панелями

# Стандартные команды переключения окон
# prefix + n - следующее окно
# prefix + p - предыдущее окно
# prefix + 0-9 - переключение на окно по номеру
# prefix + l - последнее активное окно

# Переключение окон через Alt + стрелки (без префикса)
# Ctrl + стрелки теперь работают стандартно (перемещение по словам в терминале)

# Отвязываем старые биндинги Alt+стрелок (если они были для resize-pane)
unbind -n M-Left
unbind -n M-Right
unbind -T prefix M-Left
unbind -T prefix M-Right

# Устанавливаем новые биндинги для переключения окон
bind -n M-Left previous-window   # Alt+Left - предыдущее окно
bind -n M-Right next-window      # Alt+Right - следующее окно
bind Tab last-window             # Tab - последнее активное окно (без префикса)

# Если Alt+стрелки не работают, попробуйте эти варианты (раскомментируйте один из них):
# Для некоторых терминалов Alt передается как Escape последовательность
# bind -n "\e[1;3D" previous-window   # Alt+Left (альтернативный вариант)
# bind -n "\e[1;3C" next-window      # Alt+Right (альтернативный вариант)

# Нумерация окон и панелей с 1 (по умолчанию с 0)
set -g base-index 1              # Окна начинаются с номера 1
setw -g pane-base-index 1         # Панели начинаются с номера 1

# Включить поддержку мыши
set -g mouse on                  # Позволяет переключать панели и окна мышью, прокручивать историю

# Увеличить размер scrollback (по умолчанию всего 2000 строк)
set -g history-limit 100000

##### Дополнительные полезные команды для DevOps/Backend/FullStack разработчика #####
# Раскомментируйте нужные команды по мере изучения tmux

# ===== РАБОТА С ПАНЕЛЯМИ =====
# Стандартные команды (уже работают):
# prefix + % - разделить панель вертикально (создать новую панель справа)
# prefix + " - разделить панель горизонтально (создать новую панель снизу)
# prefix + стрелки - переключение между панелями
# prefix + x - закрыть текущую панель
# prefix + z - увеличить/уменьшить панель (zoom toggle)

# Переключение между панелями без префикса (раскомментируйте при необходимости)
# bind -n C-h select-pane -L    # Ctrl+h - переключиться на панель слева
# bind -n C-j select-pane -D    # Ctrl+j - переключиться на панель снизу
# bind -n C-k select-pane -U    # Ctrl+k - переключиться на панель сверху
# bind -n C-l select-pane -R    # Ctrl+l - переключиться на панель справа

# Изменение размера панелей стрелками (раскомментируйте при необходимости)
# bind -r H resize-pane -L 5    # Shift+Left - уменьшить панель слева на 5 символов
# bind -r J resize-pane -D 5    # Shift+Down - увеличить панель снизу на 5 строк
# bind -r K resize-pane -U 5    # Shift+Up - уменьшить панель сверху на 5 строк
# bind -r L resize-pane -R 5    # Shift+Right - увеличить панель справа на 5 символов

# ===== КОПИРОВАНИЕ И ВСТАВКА =====
# Стандартный режим копирования: prefix + [ (вход), Space (начало выделения), Enter (копирование), prefix + ] (вставка)
#
# ВАЖНО ДЛЯ WSL + SSH:
# При работе через WSL Alacritty → SSH → Ubuntu сервер:
# 
# ТЕКУЩИЙ СПОСОБ (Shift+Insert / правая кнопка мыши):
# ✅ Работает через терминал - Alacritty передает данные в SSH сессию
# ✅ Простой и быстрый способ
# ⚠️ Может быть проблема с переносами строк (CRLF Windows → LF Linux)
# ⚠️ Копирование идет напрямую в терминал, минуя буфер tmux
# ⚠️ При копировании многострочного текста могут появляться символы ^M (это CR из CRLF)
#
# ПРОБЛЕМА С ПЕРЕНОСАМИ СТРОК:
# Windows использует CRLF (\r\n), Linux - LF (\n)
# При копировании из Windows в Linux могут появляться лишние символы ^M
# Решение: использовать tmux-yank (автоматически конвертирует) или настроить ниже
#
# РЕКОМЕНДАЦИЯ:
# 1. Для простого копирования - продолжайте использовать Shift+Insert / правую кнопку (это нормально!)
# 2. Для продвинутого копирования из истории tmux - используйте плагин tmux-yank
# 3. Если появляются символы ^M - используйте: sed 's/\r$//' или установите tmux-yank

# Использование системного буфера обмена (для прямого подключения к Linux, НЕ через SSH)
# Эти команды работают только если вы напрямую в Linux, не через SSH!
# set -g set-clipboard on                    # Автоматическая синхронизация с системным буфером
# bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"  # Linux (требует xclip)
# bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"  # Linux

# Для WSL + SSH лучше использовать один из вариантов ниже:

# ВАРИАНТ 1: Использовать плагин tmux-yank (РЕКОМЕНДУЕТСЯ)
# Раскомментируйте в секции плагинов: set -g @plugin 'tmux-plugins/tmux-yank'
# Плагин автоматически определит окружение и настроит копирование правильно
# После установки: prefix + y - копировать, prefix + Y - копировать в системный буфер

# ВАРИАНТ 2: Ручная настройка для SSH (если не хотите использовать плагин)
# Для работы через SSH нужно использовать OSC52 протокол (поддерживается Alacritty)
# Раскомментируйте при необходимости:
# set -g set-clipboard on                    # Включить поддержку clipboard
# bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "tmux show-buffer | clip.exe"  # WSL → Windows clipboard
# bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "tmux show-buffer | clip.exe"  # WSL → Windows clipboard

# Режим vi для копирования (раскомментируйте для использования vi-клавиш в режиме копирования)
# setw -g mode-keys vi                      # Использовать vi-клавиши в режиме копирования
# bind-key -T copy-mode-vi v send-keys -X begin-selection    # v - начать выделение
# bind-key -T copy-mode-vi y send-keys -X copy-selection      # y - скопировать выделенное
# bind-key -T copy-mode-vi r send-keys -X rectangle-toggle    # r - прямоугольное выделение

# ===== РАБОТА С ОКНАМИ =====
# Стандартные команды (уже работают):
# prefix + c - создать новое окно
# prefix + , - переименовать текущее окно
# prefix + w - список окон для выбора
# prefix + & - закрыть текущее окно

# Переименование окна по умолчанию (раскомментируйте для автоматического имени)
#set -g automatic-rename on                 # Автоматически переименовывать окна по текущей команде
set -g automatic-rename-format '#{b:pane_current_path}'  # Имя окна = текущая директория

# ===== РАБОТА С СЕССИЯМИ =====
# Стандартные команды:
# prefix + s - список сессий для выбора
# prefix + $ - переименовать текущую сессию
# tmux new -s имя - создать новую сессию с именем
# tmux attach -t имя - подключиться к сессии
# tmux ls - список всех сессий
# tmux kill-session -t имя - убить сессию

# Автоматическое переподключение при отключении SSH (раскомментируйте при необходимости)
# set -g detach-on-destroy off              # Не убивать сессию при отключении клиента

# ===== СИНХРОНИЗАЦИЯ ПАНЕЛЕЙ =====
# Полезно для выполнения одной команды во всех панелях одновременно
# bind S setw synchronize-panes            # prefix + Shift+S - включить/выключить синхронизацию всех панелей
# setw -g synchronize-panes off            # По умолчанию синхронизация выключена

# ===== ПОЛЕЗНЫЕ КОМАНДЫ ДЛЯ РАЗРАБОТКИ =====
# Открыть новое окно в текущей директории (раскомментируйте при необходимости)
# bind c new-window -c "#{pane_current_path}"  # prefix + c - создать окно в текущей директории

# Разделить панель в текущей директории (раскомментируйте при необходимости)
# bind | split-window -h -c "#{pane_current_path}"  # prefix + | - вертикальное разделение в текущей директории
# bind - split-window -v -c "#{pane_current_path}"  # prefix + - - горизонтальное разделение в текущей директории

# Быстрое переключение на последнее окно (уже настроено через Tab)
# bind C-l send-keys C-l \; clear-history  # prefix + Ctrl+l - очистить экран и историю

# ===== ИНТЕГРАЦИИ И МОНИТОРИНГ =====
# Обновление конфига без перезапуска (раскомментируйте при необходимости)
# bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"  # prefix + r - перезагрузить конфиг

# Быстрый просмотр логов (раскомментируйте при необходимости)
# bind L pipe-pane -o "cat >> ~/.tmux/logs/tmux-#{session_name}-#{window_index}-#{pane_index}.log" \; display "Logging started"
# bind U pipe-pane \; display "Logging stopped"

# ===== ПРОИЗВОДИТЕЛЬНОСТЬ =====
# Увеличить интервал обновления статус-бара (раскомментируйте для экономии ресурсов)
# set -g status-interval 5                 # Обновлять статус-бар каждые 5 секунд (по умолчанию 15)

# Отключить визуальный звонок (раскомментируйте при необходимости)
# set -g visual-activity off               # Не показывать уведомления об активности в неактивных окнах
# set -g visual-bell off                   # Отключить визуальный звонок

# ===== ПОЛЕЗНЫЕ КОМАНДЫ ДЛЯ РАБОТЫ С ЛОГАМИ И МОНИТОРИНГОМ =====
# Создание окон для типичных задач DevOps/FullStack разработчика

# Примеры использования (выполните в терминале, не в конфиге):
# tmux new-window -n "logs" "tail -f /var/log/nginx/error.log"     # Окно с логами nginx
# tmux new-window -n "php-fpm" "tail -f /var/log/php-fpm/error.log" # Окно с логами PHP-FPM
# tmux new-window -n "mysql" "mysql -u root -p"                     # Окно с MySQL
# tmux new-window -n "docker" "watch docker ps"                     # Мониторинг Docker контейнеров
# tmux new-window -n "htop" "htop"                                  # Мониторинг системы

# Быстрые команды для создания окон с мониторингом (раскомментируйте при необходимости)
bind M new-window "htop"                                           # prefix + Shift+M - окно с htop
# bind D new-window "watch -n 1 docker ps"                          # prefix + Shift+D - мониторинг Docker
# bind L new-window "tail -f /var/log/syslog"                        # prefix + Shift+L - системные логи

# ===== РАБОТА С PHP И COMPOSER =====
# Полезные команды для PHP разработки (выполняйте в терминале):
# tmux new-window -n "composer" "cd /path/to/project && composer install"
# tmux new-window -n "tests" "cd /path/to/project && phpunit"
# tmux new-window -n "artisan" "cd /path/to/project && php artisan tinker"  # Для Laravel

# ===== РАБОТА С GIT =====
# Стандартные команды Git работают в любой панели
# Полезно создать отдельное окно для Git операций:
# tmux new-window -n "git" "cd /path/to/project && git status"

# ===== SSH И УДАЛЕННЫЕ СЕРВЕРЫ =====
# Создание окон для подключения к серверам:
# tmux new-window -n "prod" "ssh user@production-server"
# tmux new-window -n "staging" "ssh user@staging-server"
# tmux new-window -n "local" "ssh user@local-vm"

# ===== РАБОТА С БАЗАМИ ДАННЫХ =====
# Создание окон для работы с БД:
# tmux new-window -n "mysql" "mysql -u urovenkna_mve -p urovenkna_mve"
# tmux new-window -n "psql" "psql -U user -d database_name"        # Для PostgreSQL
# tmux new-window -n "redis" "redis-cli"                            # Для Redis

# ===== ПОЛЕЗНЫЕ СОКРАЩЕНИЯ ДЛЯ РАЗРАБОТКИ =====
# Быстрое переключение между проектами (раскомментируйте и настройте под свои пути)
# bind -n F1 new-window -c "~/projects/project1"                    # F1 - открыть project1
# bind -n F2 new-window -c "~/projects/project2"                    # F2 - открыть project2
# bind -n F3 new-window -c "~/projects/project3"                    # F3 - открыть project3

##### Статус-бар: красивый и информативный #####

# Разместить статус-бар сверху (по умолчанию снизу)
set-option -g status-position top

# Включить статус-бар (всегда видимый)
set-option -g status on

# Высота статус-бара (1 строка)
set-option -g status-justify left

# Цвета статус-бара: тёмный фон, неоновый текст
set-option -g status-style "bg=#1e1e2e,fg=#8be9fd"

# Левая часть: имя сессии с иконкой
set -g status-left-length 30
set -g status-left "#[fg=#50fa7b,bg=#1e1e2e,bold] 󰆍 #S #[fg=#1e1e2e,bg=#50fa7b]│#[default]"
# #S - имя текущей сессии tmux
# │ - разделитель

# Правая часть: системная информация (CPU, память, время, дата, хост)
set -g status-right-length 100

# УНИВЕРСАЛЬНЫЙ ВАРИАНТ: работает всегда (время, дата, хост)
# Этот вариант работает без плагинов - используйте его если плагины не установлены
set -g status-right "#[fg=#bd93f9,bg=#1e1e2e]│#[fg=#f1fa8c]%d.%m #[fg=#bd93f9]│#[fg=#f1fa8c]%H:%M#[default] #[fg=#bd93f9]│#[fg=#ff79c6]󰌢 #[fg=#bd93f9]#h#[default] "

# РАСШИРЕННЫЙ ВАРИАНТ с плагинами (CPU и память) - раскомментируйте если установлены плагины:
# Путь к скрипту CPU может быть разным, проверьте оба варианта:
# ~/.tmux/plugins/tmux-cpu/scripts/cpu_avg.sh (стандартный путь TPM)
# ~/tmux/plugins/tmux-cpu/scripts/cpu_avg.sh (альтернативный путь)
# set -g status-right "#[fg=#bd93f9,bg=#1e1e2e]│#[fg=#ff79c6]CPU: #[fg=#8be9fd]#(~/.tmux/plugins/tmux-cpu/scripts/cpu_avg.sh)#[default] #[fg=#bd93f9]│#[fg=#ff79c6]MEM: #[fg=#8be9fd]#{memory}#[default] #[fg=#bd93f9]│#[fg=#f1fa8c]%d.%m #[fg=#bd93f9]│#[fg=#f1fa8c]%H:%M#[default] #[fg=#bd93f9]│#[fg=#ff79c6]󰌢 #[fg=#bd93f9]#h#[default] "
# 
# Объяснение переменных:
# CPU - загрузка процессора (требует плагин tmux-cpu)
# MEM - использование памяти (требует плагин tmux-mem)
# %d.%m - дата (день.месяц)
# %H:%M - время (часы:минуты)
# #h - имя хоста (компьютера)

# Окна: улучшенное форматирование с разделителями
set-window-option -g window-status-separator ""

# Активное окно: яркий фон, тёмный текст
set-window-option -g window-status-current-format "#[fg=#1e1e2e,bg=#ff5555,bold] #I: #W #[fg=#ff5555,bg=#1e1e2e]│#[default]"
# #I - номер окна, #W - имя окна
# Красный фон для активного окна, разделитель справа

# Неактивные окна: приглушённые цвета
set-window-option -g window-status-format "#[fg=#6272a4] #I: #W #[fg=#1e1e2e]│#[default]"
# Приглушённый синий для неактивных окон

# Окна с активностью (есть вывод в неактивном окне)
set-window-option -g window-status-activity-style "fg=#ffb86c,bg=#1e1e2e"

# Окна с колокольчиком (уведомления)
set-window-option -g window-status-bell-style "fg=#ff5555,bg=#1e1e2e,bold"

# Интервал обновления статус-бара (в секундах)
set -g status-interval 5

# Дополнительные настройки статус-бара для удобства:
# Автоматически скрывать статус-бар при одном окне (раскомментируйте при необходимости)
# set -g status off
# set-hook -g after-new-window 'if "[ #{session_windows} -eq 1 ]" "set status off"'
# set-hook -g after-kill-pane 'if "[ #{session_windows} -eq 1 ]" "set status off"'
# set-hook -g pane-exited 'if "[ #{session_windows} -eq 1 ]" "set status off"'
# set-hook -g window-layout-changed 'if "[ #{session_windows} -gt 1 ]" "set status on"'

# Показывать/скрывать статус-бар вручную (раскомментируйте при необходимости)
# bind s set-option status          # prefix + s - переключить видимость статус-бара (конфликт с выбором сессии!)
# bind S set-option -g status off  # prefix + Shift+S - скрыть статус-бар
# bind s set-option -g status on    # prefix + s - показать статус-бар (если скрыт)

# Дополнительная информация в статус-баре (раскомментируйте при необходимости):
# Показать количество панелей в окне:
# set-window-option -g window-status-format "#[fg=#6272a4] #I: #W #[fg=#44475a](#{window_panes})#[default] #[fg=#1e1e2e]│#[default]"
# 
# Показать текущую директорию в правой части:
# set -g status-right "#[fg=#bd93f9,bg=#1e1e2e]│#[fg=#50fa7b]#{pane_current_path}#[default] #[fg=#bd93f9]│#[fg=#f1fa8c]%H:%M#[default] "

##### Плагины #####

# Список плагинов через TPM (Tmux Plugin Manager)
set -g @plugin 'tmux-plugins/tpm'                    # Менеджер плагинов tmux
set -g @plugin 'tmux-plugins/tmux-sensible'         # Набор разумных настроек по умолчанию
set -g @plugin 'tmux-plugins/tmux-resurrect'        # Сохранение и восстановление сессий tmux
set -g @plugin 'tmux-plugins/tmux-continuum'        # Автоматическое сохранение сессий каждые 15 минут
set -g @plugin 'tmux-plugins/tmux-prefix-highlight' # Подсветка статус-бара при нажатии префикса
set -g @plugin 'tmux-plugins/tmux-cpu'              # Отображение загрузки CPU в статус-баре
set -g @plugin 'tmux-plugins/tmux-battery'          # Отображение уровня заряда батареи
set -g @plugin 'jimeh/tmux-themepack'                # Коллекция тем для tmux
set -g @themepack 'powerline/dark/blue'             # Конкретная тема: powerline, тёмная, синяя

# ===== ДОПОЛНИТЕЛЬНЫЕ ПЛАГИНЫ ДЛЯ DEVOPS/FullStack РАЗРАБОТЧИКА =====
# Раскомментируйте нужные плагины и установите их через prefix + I (Shift+i)

# Мониторинг и метрики
set -g @plugin 'tmux-plugins/tmux-mem'              # Отображение использования памяти в статус-баре
set -g @plugin 'tmux-plugins/tmux-net-speed'        # Отображение скорости сети (входящий/исходящий трафик)
# set -g @plugin 'tmux-plugins/tmux-online-status'   # Индикатор онлайн/оффлайн статуса

# Работа с сессиями и окнами
# set -g @plugin 'tmux-plugins/tmux-sessionist'       # Улучшенное управление сессиями (prefix + I/O для создания/убийства)
# set -g @plugin 'tmux-plugins/tmux-open'            # Открытие файлов/URL из tmux (prefix + o)

# Копирование и вставка
# set -g @plugin 'tmux-plugins/tmux-yank'            # Улучшенное копирование с интеграцией системного буфера
#                                                     # ОТЛИЧНО ПОДХОДИТ ДЛЯ WSL + SSH!
#                                                     # Автоматически определяет окружение и правильно настраивает копирование
#                                                     # Команды: prefix + y (копировать), prefix + Y (в системный буфер)
#                                                     # Решает проблему с переносами строк (CRLF → LF)
# set -g @plugin 'tmux-plugins/tmux-copycat'         # Поиск в истории tmux (prefix + / для поиска)

# Git интеграция (полезно для проектов)
# set -g @plugin 'tmux-plugins/tmux-gitbar'          # Отображение git статуса в статус-баре
# set -g @plugin 'tmux-plugins/tmux-git'             # Git команды прямо из tmux

# Docker и контейнеры (для DevOps)
# set -g @plugin 'tmux-plugins/tmux-docker'          # Управление Docker контейнерами из tmux

# Улучшение производительности
# set -g @plugin 'tmux-plugins/tmux-logging'         # Автоматическое логирование всех панелей (prefix + Shift+P)

# Дополнительные темы и кастомизация
# set -g @plugin 'tmux-plugins/tmux-sidebar'         # Боковая панель с файлами (prefix + B)
# set -g @plugin 'tmux-plugins/tmux-fingers'         # Быстрое копирование ссылок/путей (prefix + F)

# Уведомления
# set -g @plugin 'tmux-plugins/tmux-notify'          # Уведомления при завершении длительных команд

# Настройки для tmux-yank (если раскомментируете)
# set -g @yank_selection 'primary'                   # Использовать primary selection (Linux)
# set -g @yank_selection_mouse 'clipboard'          # Использовать clipboard при выделении мышью
# set -g @yank_action 'copy-pipe'                    # Режим копирования (copy-pipe для SSH, copy-pipe-and-cancel для локального)
#                                                     # Для WSL + SSH обычно работает автоматически, но можно настроить вручную

# Настройки для tmux-resurrect (дополнительные опции)
# set -g @resurrect-strategy-vim 'session'           # Сохранять vim сессии
# set -g @resurrect-capture-pane-contents 'on'      # Сохранять содержимое панелей
set -g @resurrect-save-bash-history 'on'           # Сохранять историю bash

# Настройки для tmux-continuum (дополнительные опции)
# set -g @continuum-restore 'on'                    # Автоматически восстанавливать сессии при запуске tmux
# set -g @continuum-save-interval '15'              # Интервал автосохранения в минутах

# Инициализация TPM (всегда в самом низу)
run '~/.tmux/plugins/tpm/tpm'                       # Загрузка менеджера плагинов
